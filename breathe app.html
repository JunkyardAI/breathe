<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diaphragmatic Breathing</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s, color 0.5s;
        }

        /* Dark Mode styles */
        body.dark {
            background-color: #111827;
            color: #d1d5db;
        }
        body.dark .text-slate-500 {
            color: #6b7280;
        }
        body.dark .text-slate-700 {
            color: #d1d5db;
        }
        body.dark .bg-indigo-500 {
            background-color: #4f46e5;
        }
        body.dark .bg-indigo-500:hover {
            background-color: #4338ca;
        }

        
        .circle {
            transition: all 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Animation states */
        .breathing-app-container.inhale .circle {
            transform: scale(1.5);
            background-color: #A3BFFA; /* Soft Blue */
        }
        .breathing-app-container.hold .circle {
            transform: scale(1.5);
            background-color: #A3BFFA; /* Soft Blue */
        }
        .breathing-app-container.exhale .circle {
            transform: scale(1);
            background-color: #A6E3B8; /* Soft Green */
        }

        .breathing-app-container.idle .circle {
            transform: scale(1);
            background-color: #E0E7FF; /* Neutral Light Blue/Lavender */
        }
        body.dark .breathing-app-container.idle .circle {
            background-color: #374151;
        }

        .visualizer-container.hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex items-center justify-center min-h-screen">

    <div id="appContainer" class="breathing-app-container idle text-center p-4 md:p-8 rounded-lg max-w-md w-full">
        
        <h1 class="text-3xl md:text-4xl font-bold mb-2">Breathe</h1>
        <p class="text-slate-500 mb-8">Follow the circle to guide your breath and find calm.</p>

        <!-- Audio Instructions -->
        <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg mb-8 text-sm text-slate-600 dark:text-slate-400">
            <h3 class="font-semibold mb-2 text-slate-700 dark:text-slate-300">Audio Cues</h3>
            <ul class="text-left list-disc list-inside space-y-1">
                <li><span class="font-medium">Low tone:</span> Breathe In</li>
                <li><span class="font-medium">Mid tone:</span> Hold</li>
                <li><span class="font-medium">High tone:</span> Breathe Out</li>
            </ul>
        </div>

        <!-- Visual Timer -->
        <div id="visualizerContainer" class="visualizer-container relative flex items-center justify-center h-48 w-48 md:h-64 md:w-64 mx-auto mb-8">
            <div class="circle absolute bg-indigo-100 rounded-full h-full w-full"></div>
            <span id="instructionText" class="relative text-xl font-medium text-slate-700">Press Start</span>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center space-y-4">
            <button id="startStopBtn" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-8 rounded-full shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 w-40">
                Start
            </button>
            <div class="flex space-x-4 mt-4">
                <button id="darkModeToggle" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-sm font-medium py-2 px-4 rounded-full transition-colors">
                    Night Mode
                </button>
                <button id="toggleVisualizer" class="bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-sm font-medium py-2 px-4 rounded-full transition-colors">
                    Hide Circle
                </button>
            </div>
        </div>
    </div>

    <script>
        const startStopBtn = document.getElementById('startStopBtn');
        const instructionText = document.getElementById('instructionText');
        const appContainer = document.getElementById('appContainer');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const toggleVisualizer = document.getElementById('toggleVisualizer');
        const visualizerContainer = document.getElementById('visualizerContainer');
        const body = document.body;

        let isRunning = false;
        let timer;
        let phase = 0; // 0: inhale, 1: hold, 2: exhale
        
        // Define the breathing cycle timings in milliseconds
        const inhaleTime = 4000;
        const holdTime = 2000;
        const exhaleTime = 6000;
        const cyclePhases = [
            { name: 'inhale', duration: inhaleTime, text: 'Breathe In...' },
            { name: 'hold', duration: holdTime, text: 'Hold' },
            { name: 'exhale', duration: exhaleTime, text: 'Breathe Out...' }
        ];

        // Create a simple synth for audio cues with Tone.js
        const synth = new Tone.Synth({
            oscillator: { type: 'sine' },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
        }).toDestination();
        
        function playSound(note) {
            // Ensure audio context is started by user interaction
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            synth.triggerAttackRelease(note, '8n');
        }

        function runCycle() {
            const currentPhase = cyclePhases[phase];

            // Update UI for the current phase
            appContainer.className = `breathing-app-container ${currentPhase.name} text-center p-4 md:p-8 rounded-lg max-w-md w-full`;
            instructionText.innerText = currentPhase.text;
            
            // Play a distinct sound for each phase start
            if (currentPhase.name === 'inhale') playSound('C4');
            if (currentPhase.name === 'hold') playSound('E4');
            if (currentPhase.name === 'exhale') playSound('G4');

            // Set timeout for the next phase
            timer = setTimeout(() => {
                phase = (phase + 1) % cyclePhases.length;
                runCycle();
            }, currentPhase.duration);
        }

        function startBreathing() {
            if (isRunning) return;
            isRunning = true;
            startStopBtn.innerText = 'Stop';
            phase = 0; // Start with inhale
            runCycle();
        }

        function stopBreathing() {
            if (!isRunning) return;
            isRunning = false;
            clearTimeout(timer);
            startStopBtn.innerText = 'Start';
            instructionText.innerText = 'Press Start';
            appContainer.className = 'breathing-app-container idle text-center p-4 md:p-8 rounded-lg max-w-md w-full';
        }

        startStopBtn.addEventListener('click', () => {
            if (isRunning) {
                stopBreathing();
            } else {
                startBreathing();
            }
        });

        darkModeToggle.addEventListener('click', () => {
            body.classList.toggle('dark');
            darkModeToggle.innerText = body.classList.contains('dark') ? 'Day Mode' : 'Night Mode';
        });

        toggleVisualizer.addEventListener('click', () => {
            visualizerContainer.classList.toggle('hidden');
            const isHidden = visualizerContainer.classList.contains('hidden');
            toggleVisualizer.innerText = isHidden ? 'Show Circle' : 'Hide Circle';
        });
    </script>
</body>
</html>


